# All-Thing-Eye Configuration

# Application
app:
  name: "All-Thing-Eye"
  version: "0.1.0"
  environment: ${APP_ENV:development}
  debug: ${APP_DEBUG:true}

# Database
database:
  # Legacy SQL Database (for migration reference only)
  main_db: ${DATABASE_URL:sqlite:///data/databases/main.db}
  echo: false # SQL 로깅
  pool_size: 10
  max_overflow: 20

# MongoDB Configuration
mongodb:
  # Connection URI format: mongodb://[username:password@]host[:port][/database][?options]
  uri: ${MONGODB_URI:mongodb://localhost:27017}
  database: ${MONGODB_DATABASE:ati}
  
  # Shared Database (for recordings and other shared data)
  shared_uri: ${MONGODB_SHARED_URI:} # If empty, uses same as main URI
  shared_database: ${MONGODB_SHARED_DATABASE:shared}
  
  # Connection Pool Settings
  max_pool_size: 100
  min_pool_size: 10
  max_idle_time_ms: 45000
  wait_queue_timeout_ms: 5000
  
  # Write Concern (data durability)
  write_concern:
    w: "majority" # Wait for majority of replica set
    j: true # Wait for journal commit
    wtimeout: 5000 # Timeout in ms
  
  # Read Preference
  read_preference: "primaryPreferred" # primary, primaryPreferred, secondary, secondaryPreferred, nearest
  
  # Collections (databases within MongoDB)
  collections:
    # Main collections
    members: "members"
    member_identifiers: "member_identifiers"
    member_activities: "member_activities"
    data_collections: "data_collections"
    
    # Plugin-specific collections
    github_commits: "github_commits"
    github_pull_requests: "github_pull_requests"
    github_issues: "github_issues"
    github_repositories: "github_repositories"
    
    slack_messages: "slack_messages"
    slack_reactions: "slack_reactions"
    slack_channels: "slack_channels"
    slack_users: "slack_users"
    
    notion_pages: "notion_pages"
    notion_comments: "notion_comments"
    notion_databases: "notion_databases"
    
    drive_activities: "drive_activities"
    drive_folders: "drive_folders"
    drive_documents: "drive_documents"
  
  # Indexing
  auto_create_indexes: true

# Data Sources (Plugins)
plugins:
  slack:
    enabled: ${SLACK_ENABLED:false}
    workspace: ${SLACK_WORKSPACE:tokamak-network}
    # Target channels to collect (empty = all channels bot is invited to)
    target_channels: [] # e.g., ['general', 'dev', 'project-zkp']
    rate_limit: 50 # requests per minute
    collection:
      include_threads: true
      include_reactions: true
      include_files: true

  github:
    enabled: ${GITHUB_ENABLED:true}
    token: ${GITHUB_TOKEN}
    organization: ${GITHUB_ORG}
    rate_limit: 5000 # requests per hour (GitHub limit)
    collection:
      commits: true
      pull_requests: true
      issues: true
      code_reviews: true
      repositories: [] # empty = all repos
      include_diff: true # Include actual code diffs (WARNING: many API calls!)
    # Team members list (GitHub username mapping)
    member_list:

  google_drive:
    enabled: true
    # OAuth2 credentials path (place credentials.json in config/google_drive/)
    credentials_path: "config/google_drive/credentials.json"
    # Token path - must be in writable directory (logs is mounted rw)
    token_path: "/app/logs/token_admin.pickle"
    # Target users to track (empty = all users in organization)
    target_users: [] # e.g., ['george@tokamak.network', 'kevin@tokamak.network']
    days_to_collect: 7 # Default collection period
    # Member mapping
    member_list:
      - name: "Kevin"
        githubId: "ggs134"
        email: "kevin@company.com"
      - name: "Jason"
        githubId: "cd4761"
        email: "jason@company.com"
      - name: "Theo"
        githubId: "theo-learner"
        email: "theo@company.com"
      - name: "Ale"
        githubId: "SonYoungsung"
        email: "ale@company.com"
      # Add more members as needed

  notion:
    enabled: ${NOTION_ENABLED:true}
    token: ${NOTION_TOKEN}
    workspace_id: ${NOTION_WORKSPACE_ID}
    days_to_collect: 7 # Default collection period
    rate_limit: 3 # requests per second
    collection:
      pages: true
      databases: true
      comments: true
    # Member mapping
    member_list:

# Projects Configuration
# Note: Only basic fields are kept here. Full project configuration is managed in MongoDB.
# This serves as initial seed data. Use MongoDB API to update project details.
projects:
  project-ooo:
    name: "Project OOO"
    slack_channel: "project-ooo"
    lead: "Jake"

  project-eco:
    name: "Project ECO"
    slack_channel: "project-eco"
    lead: "Jason"

  project-syb:
    name: "Project SYB"
    slack_channel: "project-sybil"
    lead: "Jamie"

  project-trh:
    name: "Project TRH"
    slack_channel: "project_trh"
    lead: "Praveen"

# Member Index
member_index:
  auto_create_members: true
  fuzzy_matching: true # 이름 유사도 매칭
  matching_threshold: 0.85

# Scheduler
scheduler:
  enabled: ${SCHEDULER_ENABLED:true}
  timezone: "Asia/Seoul"
  jobs:
    - name: "daily_collection"
      plugin: "all"
      schedule:
        type: "cron"
        hour: 2
        minute: 0
      config:
        days: 1

    - name: "weekly_full_sync"
      plugin: "all"
      schedule:
        type: "cron"
        day_of_week: 0 # Sunday
        hour: 3
        minute: 0
      config:
        days: 7

    - name: "cleanup_old_data"
      plugin: "cleanup"
      schedule:
        type: "cron"
        day: 1 # 매월 1일
        hour: 4
        minute: 0
      config:
        retention_days: ${DATA_RETENTION_DAYS:365}

# Data Collection
collection:
  default_days: ${DATA_COLLECTION_DAYS:30}
  batch_size: 100
  retry_attempts: 3
  retry_delay_seconds: 5
  timeout_seconds: 300

# API Server
api:
  host: ${API_HOST:0.0.0.0}
  port: ${API_PORT:8000}
  workers: ${API_WORKERS:4}
  reload: false # development only
  cors:
    enabled: true
    origins: ${CORS_ORIGINS:http://localhost:3000}
    allow_credentials: true
    allow_methods: ["*"]
    allow_headers: ["*"]
  rate_limit:
    enabled: true
    requests_per_minute: 60

# AI Integration
ai:
  provider: ${AI_PROVIDER:openai}
  api_key: ${AI_API_KEY}
  model: ${AI_MODEL:gpt-4}
  temperature: 0.7
  max_tokens: 2000
  prompt_templates:
    performance_analysis: "templates/performance_analysis.txt"
    team_insights: "templates/team_insights.txt"

# Logging
logging:
  level: ${LOG_LEVEL:INFO}
  format: "json" # json or text
  output:
    console: true
    file: true
    file_path: "logs/app.log"
  rotation:
    max_bytes: 10485760 # 10MB
    backup_count: 5

# Security
security:
  secret_key: ${SECRET_KEY}
  algorithm: ${JWT_ALGORITHM:HS256}
  access_token_expire_minutes: ${ACCESS_TOKEN_EXPIRE_MINUTES:30}
  encryption:
    enabled: true
    algorithm: "AES256"

# Cache
cache:
  enabled: true
  backend: "memory" # memory, redis
  redis_url: ${REDIS_URL}
  ttl_seconds: ${CACHE_TTL_SECONDS:3600}
  max_size: 1000 # for memory backend

# Monitoring
monitoring:
  prometheus:
    enabled: ${PROMETHEUS_ENABLED:false}
    port: 9090
  sentry:
    enabled: false
    dsn: ${SENTRY_DSN}
    environment: ${APP_ENV:development}
    traces_sample_rate: 0.1

# Feature Flags
features:
  auto_member_creation: true
  ai_analysis: true
  real_time_sync: false
  advanced_analytics: false
